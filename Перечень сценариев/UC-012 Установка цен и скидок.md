## UC-012 Установка цен и скидок

| Поле                | Значение                        |
|---------------------|---------------------------------|
| **ID**              | UC-012                          |
| **Название**        | Установка цен и скидок          |
| **Требования**      | FR-122: Массовое изменение цен; FR-123: Настройка временных скидок |
| **Элемент Бэклога** |                                 |
| **Сервис**          | pricing-service                 |
| **Статус**          | ЧЕРНОВИК                        |
| **Описание**        | Сценарий описывает процесс управления ценами и скидками для товаров продавцом. Продавец может изменять цены на отдельные товары или массово, а также настраивать временные скидки с указанием периода действия.  |
| **Участники**       | ROLE_SELLER (Продавец)          |
| **Триггер**         | Продавец открывает раздел «Управление ценами» в личном кабинете или выбирает опцию «Изменить цены» в списке товаров. |
| **Предусловия**     | 1. Продавец авторизован в системе.<br>2. У продавца есть хотя бы один товар в каталоге.<br>3. Сервис `pricing-service` доступен.<br>4. Продавец имеет права на управление ценами своих товаров. |
| **Постусловия**     | - **Успешное завершение:** Цены и/или скидки успешно применены к выбранным товарам.<br>- **Альтернативное завершение:** Изменения отменены пользователем или отклонены системой из-за валидации.<br>- **Исключительное завершение:** Ошибка при применении изменений; цены остались без изменений.|
| **Успешный сценарий** | 1. Продавец открывает раздел «Управление ценами» в личном кабинете или выбирает опцию «Изменить цены» в списке товаров. Система отображает таблицу товаров продавца с текущими ценами и скидками.<br>2. Продавец выбирает режим работы:<br>   - «Изменить цены для выбранных товаров»<br>   - «Настроить скидки»<br>3. **Сценарий А (Изменение цены для одного товара):**<br>   - Продавец находит товар в списке и кликает на поле «Цена»<br>   - Система открывает редактор цены с текущим значением и возможностью указать новую цену и валюту (если поддерживается)<br>   - Продавец вводит новую цену и подтверждает (кнопка «Сохранить»)<br>   - Система отправляет запрос к `pricing-service`: PATCH /api/v1/pricing/products/{productId} с телом { "price": новая_цена }<br>   - `pricing-service` возвращает HTTP 200 + подтверждение обновления цены (маппинг: **FR-122**)<br>   - Система отображает уведомление: *«Цена успешно обновлена»* и обновляет значение в таблице (маппинг: **FR-122**)<br>4. **Сценарий Б (Настройка временной скидки):**<br>   - Продавец выбирает товар и нажимает кнопку «Добавить скидку»<br>   - Система открывает модальное окно настройки скидки с полями:<br>     • Тип скидки (процент, фиксированная сумма)<br>     • Размер скидки<br>     • Дата начала действия (по умолчанию — текущая дата)<br>     • Дата окончания действия<br>     • Условия (минимальный объём заказа, комбинация с другими скидками)<br>   - Продавец заполняет параметры и подтверждает (кнопка «Применить скидку»)<br>   - Система отправляет запрос к `pricing-service`: POST /api/v1/pricing/discounts с телом { "productId": id, "discountType": "...", "value": ..., "startDate": "...", "endDate": "..." }<br>   - `pricing-service` возвращает HTTP 201 + данные о созданной скидке (маппинг: **FR-123**)<br>   - Система отображает уведомление: *«Скидка успешно настроена»* и отображает информацию о скидке в таблице товаров (маппинг: **FR-123**)<br> |
| **Альтернативный сценарий АС1** | На любом шаге ввода цены или скидки продавец вводит некорректное значение (отрицательная цена, скидка > 100%, дата окончания раньше даты начала).<br>Система валидирует введённые данные в реальном времени.<br>Отображает сообщение об ошибке рядом с полем:<br> *«Цена не может быть отрицательной»*<br> *«Скидка не может превышать 100%»*<br> *«Дата окончания должна быть позже даты начала»*<br>Кнопка подтверждения остаётся неактивной до исправления ошибок.<br>Продавец исправляет данные и продолжает работу. |
| **Альтернативный сценарий АС2** | Продавец хочет удалить или отменить ранее настроенную скидку.<br>Продавец находит товар со скидкой и нажимает кнопку «Управление скидкой».<br>Система открывает окно с текущими параметрами скидки и кнопкой «Отменить скидку».<br>Продавец подтверждает отмену.<br>Система отправляет запрос к `pricing-service`: DELETE /api/v1/pricing/discounts/{discountId}<br>`pricing-service` возвращает HTTP 200.<br>Система отображает уведомление: *«Скидка отменена»* и убирает информацию о скидке из таблицы. |
| **Сценарий исключений СИ1** | После отправки запроса к `pricing-service` (любой шаг) сервис возвращает ошибку валидации (HTTP 400):<br> - Цена ниже минимально допустимой для категории товара.<br> - Конфликт с правилами маркетплейса (например, скидка превышает лимит).<br>Система отображает сообщение:<br> *«Не удалось применить изменения: {причина из ответа}»*<br>Продавец может исправить параметры и повторить попытку. |
| **Сценарий исключений СИ2** | `pricing-service` возвращает HTTP 5xx или таймаут > 5с.<br>Система логирует ошибку (уровень ERROR) с traceID и деталями запроса.<br>Отображает пользователю:<br> *«Не удалось сохранить изменения. Повторите попытку позже»*|
